<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Command Center - Silvi Maulida</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="radar"></div>

    <div id="login-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; backdrop-filter:blur(15px);">
        <h2 style="font-family:'Orbitron'; color:#00ffff; margin-bottom:20px;">SECURITY CHECK</h2>
        <input type="password" id="pin-input" placeholder="PIN" maxlength="4" style="padding:15px; font-size:24px; text-align:center; border-radius:10px; border:1px solid #00ffff; background:none; color:white;">
        <button onclick="checkPin()" style="margin-top:20px; padding:10px 30px; background:#00ffff; border:none; cursor:pointer; font-weight:bold; font-family:'Orbitron';">ACCESS COMMAND CENTER</button>
    </div>

    <div id="main-admin" style="display:none; padding: 20px; min-height: 100vh;">
        <header>
            <h1 style="margin:0; font-family:'Orbitron'; color:white;">üõ∞Ô∏è COMMAND CENTER v2.0</h1>
            <p style="color:#00ffff; font-weight:bold;">CHIEF OFFICER: SILVI MAULIDA</p>
            <div id="clock" style="font-size: 20px; color: #00ffff; margin-bottom: 10px;"></div>

            <button onclick="toggleLockdown()" id="btn-lockdown" style="padding:5px 15px; background:rgba(255,0,0,0.2); border:1px solid red; color:white; cursor:pointer; font-family:'Orbitron'; font-size:10px; border-radius:20px;">üö® INITIATE LOCKDOWN</button>

            <div id="weather-widget">
                <div id="weather-icon" style="font-size: 24px;">‚òÅÔ∏è</div>
                <div style="text-align: left;">
                    <div id="weather-temp" style="font-family: 'Orbitron'; font-size: 18px; color: #00ffff;">--¬∞C</div>
                    <div id="weather-desc" style="font-size: 10px; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8;">MEMINDAI CUACA...</div>
                </div>
                <div style="border-left: 1px solid rgba(0, 255, 255, 0.3); padding-left: 10px;">
                    <div id="weather-city" style="font-size: 10px; font-weight: bold; color: white;">LOCATION: --</div>
                </div>
            </div>
        </header>

        <div class="stat-container">
            <div class="stat-box"><h3>Medical Active</h3><span class="number" id="count-Ambulance">0</span></div>
            <div class="stat-box"><h3>Fire Active</h3><span class="number" id="count-Damkar">0</span></div>
            <div class="stat-box"><h3>Police Active</h3><span class="number" id="count-Polisi">0</span></div>
            <div class="stat-box"><h3>SAR Active</h3><span class="number" id="count-Timsar">0</span></div>
        </div>

        <div class="admin-dashboard">
            <div class="column col-medis"><h2>üöë MEDICAL</h2><div id="list-Ambulance"></div></div>
            <div class="column col-damkar"><h2>üî• FIRE</h2><div id="list-Damkar"></div></div>
            <div class="column col-polisi"><h2>üöî POLICE</h2><div id="list-Polisi"></div></div>
            <div class="column col-timsar"><h2>üöÅ TIMSAR</h2><div id="list-Timsar"></div></div>
        </div>

        <div style="margin-top:40px; background:rgba(0,0,0,0.3); padding:20px; border-radius:15px; border: 1px solid rgba(0,255,255,0.2);">
            <h3 style="color:#00ffff; font-family:'Orbitron'; margin-top:0;">üìö HISTORY LOG</h3>
            <div id="list-history"></div>
        </div>
    </div>

    <script>
        const PIN_BENAR = "1234";
        let jumlahLaporanLama = (JSON.parse(localStorage.getItem('laporan_gawat')) || []).length;
        let isLockdown = false;

        function checkPin() {
            if (document.getElementById('pin-input').value === PIN_BENAR) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-admin').style.display = 'block';
                
                // NO 3: VOICE WELCOME
                let msg = new SpeechSynthesisUtterance("Akses diterima. Selamat datang, Chief Officer Silvi Maulida. Semua sistem operasional.");
                msg.lang = 'id-ID';
                window.speechSynthesis.speak(msg);

                loadReports(); loadHistory(); getWeatherData();
            }
        }

        function toggleLockdown() {
            isLockdown = !isLockdown;
            const screen = document.getElementById('main-admin');
            const btn = document.getElementById('btn-lockdown');
            if (isLockdown) {
                screen.classList.add('lockdown-active');
                btn.innerText = "‚ö†Ô∏è ABORT LOCKDOWN";
                btn.style.background = "red";
                let alert = new SpeechSynthesisUtterance("Protokol Lockdown diaktifkan!");
                alert.lang = 'id-ID'; window.speechSynthesis.speak(alert);
            } else {
                screen.classList.remove('lockdown-active');
                btn.innerText = "üö® INITIATE LOCKDOWN";
                btn.style.background = "rgba(255,0,0,0.2)";
            }
        }

        async function getWeatherData() {
            const apiKey = 'b7123363f060adb244dcc8cf3d443e09'; 
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (pos) => {
                    try {
                        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&appid=${apiKey}&units=metric&lang=id`);
                        const data = await response.json();
                        document.getElementById('weather-temp').innerText = `${Math.round(data.main.temp)}¬∞C`;
                        document.getElementById('weather-desc').innerText = data.weather[0].description;
                        document.getElementById('weather-city').innerText = `LOC: ${data.name.toUpperCase()}`;
                    } catch (e) { console.log("Weather Error"); }
                });
            }
        }

        function loadReports() {
            const data = JSON.parse(localStorage.getItem('laporan_gawat')) || [];
            const counts = { Ambulance: 0, Damkar: 0, Polisi: 0, Timsar: 0 };
            ["Ambulance", "Damkar", "Polisi", "Timsar"].forEach(k => document.getElementById(`list-${k}`).innerHTML = "");
            
            data.forEach((item, index) => {
                if(counts[item.kategori] !== undefined) counts[item.kategori]++;
                const target = document.getElementById(`list-${item.kategori}`);
                if(target) {
                    const isKritis = item.prioritas === "Tinggi" ? "kritis-active" : "";
                    target.innerHTML += `
                        <div class="report-card ${isKritis}" style="border-left: 10px solid ${getBorderColor(item.kategori)}">
                            <strong>üë§ ${item.nama}</strong> [${item.prioritas}]<br>
                            <small>‚è∞ ${item.waktu}</small>
                            <p style="background:#eee; padding:5px; border-radius:5px;">${item.detail}</p>
                            <button onclick="tandaiSelesai(${index})" style="width:100%; background:black; color:white; border:none; padding:8px; cursor:pointer; border-radius:5px;">SELESAI</button>
                        </div>`;
                }
            });
            document.getElementById('count-Ambulance').innerText = counts.Ambulance;
            document.getElementById('count-Damkar').innerText = counts.Damkar;
            document.getElementById('count-Polisi').innerText = counts.Polisi;
            document.getElementById('count-Timsar').innerText = counts.Timsar;
        }

        function getBorderColor(cat) {
            return cat==='Ambulance'?'#800000':cat==='Damkar'?'#ff4500':cat==='Polisi'?'#000080':'#ff8c00';
        }

        function tandaiSelesai(idx) {
            let data = JSON.parse(localStorage.getItem('laporan_gawat')) || [];
            let harian = JSON.parse(localStorage.getItem('history_gawat')) || [];
            harian.push({...data[idx], waktuSelesai: new Date().toLocaleTimeString()});
            localStorage.setItem('history_gawat', JSON.stringify(harian));
            data.splice(idx, 1);
            localStorage.setItem('laporan_gawat', JSON.stringify(data));
            loadReports(); loadHistory();
        }

        function loadHistory() {
            const h = JSON.parse(localStorage.getItem('history_gawat')) || [];
            document.getElementById('list-history').innerHTML = h.slice().reverse().map(item => `
                <div class="history-item">‚úÖ [${item.waktuSelesai}] Unit ${item.kategori} selesai: ${item.nama}</div>
            `).join('');
        }

        setInterval(() => {
            let data = JSON.parse(localStorage.getItem('laporan_gawat')) || [];
            if (data.length > jumlahLaporanLama) {
                let terbaru = data[data.length-1];
                let msg = new SpeechSynthesisUtterance(`Peringatan. Laporan ${terbaru.kategori} masuk.`);
                msg.lang = 'id-ID'; window.speechSynthesis.speak(msg);
                jumlahLaporanLama = data.length; loadReports();
            } else if (data.length < jumlahLaporanLama) {
                jumlahLaporanLama = data.length; loadReports();
            }
        }, 2000);

        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleString('id-ID'); }, 1000);
    </script>
</body>
</html>