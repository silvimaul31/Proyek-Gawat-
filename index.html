<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Gawat!!!! - User Interface</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --timsar: #ff8c00; --maroon: #800000; --orange: #ff8c00; --navy: #000080; }

        /* Animasi Berdenyut untuk Tombol SOS */
        @keyframes pulse-sos {
            0% { transform: scale(1); box-shadow: 0 0 0px #ff0000; }
            50% { transform: scale(1.05); box-shadow: 0 0 30px #ff0000; }
            100% { transform: scale(1); box-shadow: 0 0 0px #ff0000; }
        }

        .sos-container {
            padding: 20px;
            text-align: center;
            background: rgba(255, 0, 0, 0.1);
            border-bottom: 1px solid rgba(255, 0, 0, 0.3);
        }

        .btn-panic {
            background: linear-gradient(45deg, #ff0000, #800000);
            border: 3px solid #ffffff;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            color: white;
            font-family: 'Orbitron', sans-serif;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            animation: pulse-sos 1s infinite;
            transition: 0.3s;
        }

        .btn-panic:active { transform: scale(0.9); }

        .btn-sos {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="user-float">
        <div style="background: rgba(128, 0, 0, 0.8); padding: 25px; text-align: center;">
            <h1 style="margin:0; font-family: 'Orbitron'; letter-spacing:2px;">üö® GAWAT!!!!</h1>
            <p style="font-size:11px; margin-top:5px; opacity:0.8;">TEKAN TOMBOL UNTUK BANTUAN INSTAN</p>
        </div>

        <div class="sos-container">
            <button id="sos-btn" class="btn-panic">SOS</button>
            <p style="color: #ff4444; font-family: 'Orbitron'; font-size: 9px; margin-top: 10px; letter-spacing: 1px;">
                EMERGENCY ONLY
            </p>
        </div>

        <div style="padding: 25px;">
            <label style="font-size: 12px; opacity: 0.7;">Nama Pelapor:</label>
            <input type="text" id="nama-pelapor" placeholder="Masukkan nama Anda..." 
                   style="width:100%; padding:12px; margin:10px 0 15px 0; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background:rgba(255,255,255,0.05); color:white; box-sizing: border-box; outline:none;">

            <label style="font-size: 12px; opacity: 0.7;">Tingkat Darurat:</label>
            <select id="prioritas" style="width:100%; padding:12px; margin:10px 0 15px 0; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background:#222; color:white; outline:none;">
                <option value="Normal">üü¢ Normal (Butuh Bantuan)</option>
                <option value="Tinggi">üî¥ KRITIS (Nyawa Terancam!)</option>
            </select>

            <label style="font-size: 12px; opacity: 0.7;">Detail Kejadian:</label>
            <textarea id="detail-kejadian" placeholder="Ceritakan singkat kejadiannya..." 
                      style="width:100%; padding:12px; margin:10px 0 20px 0; border-radius:10px; border:1px solid rgba(255,255,255,0.2); background:rgba(255,255,255,0.05); color:white; box-sizing: border-box; outline:none; height: 80px; resize: none; font-family: 'Poppins', sans-serif;"></textarea>

            <div style="display: grid; gap: 15px;">
                <button onclick="kirimKeFirebase('Ambulance')" class="btn-sos" style="background:var(--maroon); box-shadow: 0 0 15px var(--maroon);">üöë AMBULANCE (MEDIS)</button>
                <button onclick="kirimKeFirebase('Damkar')" class="btn-sos" style="background:var(--orange); box-shadow: 0 0 15px var(--orange);">üî• DAMKAR (KEBAKARAN)</button>
                <button onclick="kirimKeFirebase('Polisi')" class="btn-sos" style="background:var(--navy); box-shadow: 0 0 15px var(--navy);">üöî POLISI (KRIMINAL)</button>
                <button onclick="kirimKeFirebase('Timsar')" class="btn-sos" style="background:var(--timsar); box-shadow: 0 0 15px var(--timsar);">üöÅ TIMSAR (PENYELAMATAN)</button>
            </div>
        </div>
        
        <p style="text-align:center; padding-bottom:20px; font-size:9px; opacity:0.5; letter-spacing:1px;">GPS AKTIF - REAL TIME TRACKING</p>
        <a href="admin.html" style="display:block; text-align:center; padding-bottom:10px; color:rgba(255,255,255,0.1); text-decoration:none; font-size:8px;">OFFICER LOGIN</a>
    </div>

    <script>
        // --- KONFIGURASI FIREBASE ---
        // Silvi, jangan lupa isi apiKey dan databaseURL asli kamu di sini ya!
        const firebaseConfig = {
            apiKey: "AIzaSy...", 
            authDomain: "gawatapp.firebaseapp.com",
            databaseURL: "https://gawatapp-default-rtdb.firebaseio.com", 
            projectId: "gawatapp",
            storageBucket: "gawatapp.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- FUNGSI KIRIM LAPORAN + FITUR MAPS ---
        function laporGawat(nama, teks, prioritas, kategori) {
            // Tampilkan loading sebentar
            console.log("Mencoba mengambil lokasi...");

            if (navigator.geolocation) {
                // Gunakan High Accuracy agar lokasi tidak meleset
                const geoOptions = {
                    enableHighAccuracy: true,
                    timeout: 5000,
                    maximumAge: 0
                };

                navigator.geolocation.getCurrentPosition((pos) => {
                    const lat = pos.coords.latitude;
                    const lng = pos.coords.longitude;

                    db.ref('laporan_gawat').push({
                        nama: nama,
                        pesan: teks,
                        prioritas: prioritas,
                        kategori: kategori,
                        lat: lat,
                        lng: lng,
                        waktu: new Date().toLocaleTimeString(),
                        timestamp: Date.now()
                    }).then(() => {
                        alert(`üöÄ LAPORAN ${kategori.toUpperCase()} TERKIRIM!\nLokasi: ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
                        document.getElementById('nama-pelapor').value = "";
                        document.getElementById('detail-kejadian').value = "";
                    }).catch((err) => {
                        alert("Gagal kirim ke Firebase: " + err.message);
                    });
                }, (error) => {
                    alert("GPS Gagal: Pastikan fitur Lokasi di HP/Laptop menyala.");
                }, geoOptions);
            } else {
                alert("Browser kamu tidak mendukung pelacakan GPS.");
            }
        }

        // --- LOGIKA TOMBOL ---

        // Tombol SOS Instan
        document.getElementById('sos-btn').onclick = () => {
            if(confirm("üö® KIRIM SINYAL SOS SEKARANG?\nKoordinat lokasi Anda akan dikirim ke pusat komando!")) {
                laporGawat("‚ö†Ô∏è SOS USER", "PANGGILAN DARURAT SOS! BUTUH BANTUAN SEGERA!", "Tinggi", "Ambulance");
            }
        };

        // Tombol Kategori (Ambulance, Damkar, dll)
        function kirimKeFirebase(kategori) {
            const nama = document.getElementById('nama-pelapor').value;
            const detail = document.getElementById('detail-kejadian').value;
            const prioritas = document.getElementById('prioritas').value;

            if(!nama || !detail) {
                alert("Waduh, isi Nama dan Detail Kejadian dulu ya!");
                return;
            }
            laporGawat(nama, detail, prioritas, kategori);
        }
    </script>
</body>
</html>
